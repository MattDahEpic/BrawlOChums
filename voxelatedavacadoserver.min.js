var websock=require("./node_modules/ws"),struct=require("./boc_struct.js"),boc_handshake=require("./boc_handshake.js");console.log("Starting VoxelatedAvacado server.");var wss=new websock.Server({port:36245});process.on("SIGINT",function(){console.log("Received SIGINT, stopping gracefully...");wss.clients.forEach(function(a){console.log("-Ended connection with "+a.upgradeReq.socket.remoteAddress+" (1001)");a.close(1001)});process.exit(1)});
wss.on("connection",function(a,b){console.log("+Received connection from "+a._socket.remoteAddress);a.upgradeReq=b;a.hasHandshook=!1;a.onmessage=function(c){try{var b=JSON.parse(c.data)}catch(d){a.send('{"e":"Invalid json."}');return}a.hasHandshook||boc_handshake(b,a)};a.onclose=function(){"game"===a.clientType?(struct.connections.get(a.gameCode).clients.forEach(function(a){a.close(4002)}),struct.connections.delete(a.gameCode)):"undefined"!==typeof a.gameCode&&struct.connections.get(a.gameCode).clients.set(a.clientIdentifier,
null)}});
